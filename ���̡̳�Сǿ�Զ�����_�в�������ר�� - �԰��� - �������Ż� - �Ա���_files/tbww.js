TB.namespace("ww");(function(){var e=YAHOO.util,c=e.Dom,t=e.Event,i=e.Lang;var n="J_WangWangScript";var s=/tbww(\.source)?\.js(\??[^#]*)/;var p="http://web2.im.alisoft.com";var h="http://amos.im.alisoft.com";var f="http://webwwtb.im.alisoft.com";var j="http://assets.taobaocdn.com";var m=h+"/muliuserstatus.aw?beginnum=0&site=cntaobao&charset=utf-8&uids=";var o=h+"/online.aw?v=2&site=cntaobao&charset=utf-8&uid=";var l=p+"/GetData/GetTribeInfoByKeywords?site=cntaobao&v=2";var d=p+"/GetData/GetTribeInfoByUid?site=cntaobao&v=2";var b=j+"/sys/wangwang/website.js?t=20090319.js";var q="chrome://wangwangapi/content/api.js";window.online=[];window.tracenick=window.tracenick||"";window.clearWW=function(){var u=c.get("webWWFrame");if(u){u.parentNode.removeChild(u)}};var a="\u70b9\u6b64\u53ef\u4ee5\u76f4\u63a5\u548c\u5356\u5bb6\n\u4ea4\u6d41\u9009\u597d\u7684\u5b9d\u8d1d\uff0c\u6216\n\u76f8\u4e92\u4ea4\u6d41\u7f51\u8d2d\u4f53\u9a8c\uff0c\n\u8fd8\u652f\u6301\u8bed\u97f3\u89c6\u9891\u5662\u3002";var g=100;var r={};r.installed=false;r.version="";r._onStatusDataLoadEvent=new e.CustomEvent("statusDataLoad",r,false,e.CustomEvent.FLAT);r.light=function(v,u){var w=r.getParamsFromData(v);v.appendChild(r._buildWWLink(w,u))};r.lightByIcon=function(u,w){var z=r.getParamsFromData(u);var y=o+encodeURIComponent(z.nick);y+="&s="+((z.icon&&z.icon.toLowerCase()=="small")?2:1);if(z&&z.nick){var v='<img src="'+y+'" border="0" />';var x=r._buildWWLink(z);x.innerHTML=v;u.innerHTML="";u.appendChild(x)}};r.getParamsFromData=function(u){var v={};if(c.hasClass(u,"J_WangWang")){v.nick=u.getAttribute("data-nick");if(u.getAttribute("data-item")){v.item=u.getAttribute("data-item")}v.display=u.getAttribute("data-display");v.icon=u.getAttribute("data-icon");v.self=u.getAttribute("self");if(!v.tnick){v.tnick=v.nick}}else{if(c.hasClass(u,"ww:token")){v=u.getAttribute("ww:params").toQueryParams()}}i.augmentObject(v,r._scriptParams,false);return v};r._buildWWLink=function(x,y){var B=x.icon?x.icon.toLowerCase():"large";var z=x.display?x.display.toLowerCase():"block";var u=x.nick||"";var D=x.tnick||"";var E=x.self||"";var C=x.item||window._item||"";var w=x.oid||"";var A=document.createElement("a");A.href="javascript: void(0);";A.setAttribute("target","_blank");if(y==1){c.addClass(A,"ww-online");A.title=a;A.innerHTML="<span>\u65fa\u65fa\u5728\u7ebf</span>"}else{if(y==4||y==5){c.addClass(A,"ww-mobile");A.innerHTML="<span>\u624b\u673a\u5728\u7ebf</span>"}else{if(y==0||y==2||y==3||y==6){c.addClass(A,"ww-offline");A.innerHTML="<span>\u65fa\u65fa\u79bb\u7ebf</span>"}}}if(typeof y!="undefined"){c.addClass(A,"ww-"+B);c.addClass(A,"ww-"+z)}if(r.installed){if(window.onlinewangWangSend){A.onclick=function(){var F="nick="+u+"&uid_t="+D+"&status="+y+"&gid="+C+"&suid="+window.tracenick+"&self="+E;if(w){F+="&oid="+w}onlinewangWangSend("cntaobao",window.tracenick,"cntaobao",u,y,F);return false}}else{if(YAHOO.env.ua.gecko){var v;if(r.installed&1){v="aliim:sendmsg?touid=cntaobao"+u+"&uid="+window.tracenick+"&gid="+C}else{if(r.installed&2){v="wangwang:SendIM?uid="+u+"&uid_t="+D+"&suid="+window.tracenick+"&gid="+C}else{if(r.installed&4){v="alitalk:SendIM?uid="+u+"&AliLoginID="+window.tracenick+"&gid="+C}}}A.target="_self";t.on(A,"click",function(F){window.location=v;t.preventDefault(F)})}}}else{A.target="_blank";A.href=f+"/wangwang/ww1.htm?t="+new Date().getTime()+"&uid="+escape(window.tracenick)+"&tid="+escape(u);if(YAHOO.env.ua.gecko){A.onclick=function(F){F.target.target="_blank";return true}}else{A.onclick=function(F){window.open(A.href,"","width=0,height=0,left=0,top=0,location=yes,menubar=yes,toolbar=yes,status=yes,resizable=yes,scrollbars=yes");return false}}}return A};r.login=function(v){if(i.isString(v)&&v.trim().length>1&&r.installed){try{var w="wangwang:login?suid="+v+"&autologin=1&auto=1";var u=window.frames.aliwangwangSendmsgShowFrame;if(!u){u=document.createElement("iframe");document.body.appendChild(u);iframe.setAttribute("target","_blank");iframe.setAttribute("src",w)}else{u.location=w}}catch(x){}}};r.talk=function(u,v){v=v||{};if(i.isString(u)&&u.trim().length>1&&r.installed){var w="nick="+u+"&suid="+window.tracenick;for(k in v){w+="&"+k+"="+v[k]}onlinewangWangSend("cntaobao",window.tracenick,"cntaobao",u,v.status||1,w)}};r.loadTribes=function(u){var w="";if(u.keywords){w=l+"&keywords="+u.keywords}else{if(u.uid){w=d+"&uid="+u.uid+"&type="+u.type}else{return}}if(u.count){w+="&count="+u.count}var v=c.generateId(null,"tribe");window["display_"+v]=function(){u.callback(window[v+"Obj"])};w+="&name="+v;var x=(document.charset||document.characterSet).toLowerCase();e.Get.script(w,{onSuccess:function(){},varName:v+"Obj",charset:x})};r.buildTribeLink=function(x,w){var u=w;if(w.length>9){u=w.substr(0,7)+"..."}var y="http://www2.im.alisoft.com/webim/tribe/tribe_detail.htm?userId=cntaobao&tribeId="+x;var v="window.open('"+y+"', '_blank', 'height=400, width=500, top=60, left=150, toolbar=no, menubar=no, scrollbars=yes, resizable=no,location=no, status=no'); return false;";return'<a href="#" onclick="'+v+'" target="_blank" title="'+w+'">'+u+"</a>"};r._statusMap={};r.lightAll=function(F,J){if(J){this._scriptParams=i.merge(this._scriptParams,J)}var G=c.getElementsByClassName("ww:token","span",c.get(F));var I=c.getElementsByClassName("J_WangWang","span",c.get(F));G=G.concat(I);var B=[],O,N;for(var K=0;K<G.length;K++){N=r.getParamsFromData(G[K]);O=N.nick||"";G[K].setAttribute("ww:nick",O);B.push(O)}var z=function(R){var S=R.data.nicks,Q=R.data.tokens;for(var P=0;P<S.length;P++){r._statusMap[S[P]]=window.online[P]}r._onStatusDataLoadEvent.fire(Q);if(r.doAfterStatusDataLoad){r.doAfterStatusDataLoad(window.online||[])}window.online.length=0;if(R.data.next){R.data.next()}};var A=function(Q,S,R){var P=m;P+=encodeURIComponent(Q.join(";"));e.Get.script(P,{onSuccess:z,varName:"online",data:{tokens:S,nicks:Q,next:R},charset:"utf-8"})};var v=2000;var u=[];var w=[];var D="",C=0,E=0;for(var H=0,L=B.length;H<L;++H){if(x(D+B[H])||H>g-1||H==L-1){var y=(H==L-1)?L:H;u[E]=B.slice(C,y);w[E]=G.slice(C,y);D="";C=H;E++}D+=B[H]+";"}M(0);function M(P){A(u[P],w[P],function(){E--;if(E){M(P+1)}})}function x(P){if(YAHOO.env.ua.ie){return encodeURIComponent(P).length>v}return false}};r._autoLight=function(){r.lightAll(document.body)};r._init=function(){(function(y,A){A=A||document;var z=A.createElement("style");z.type="text/css";A.getElementsByTagName("head")[0].appendChild(z);if(z.styleSheet){z.styleSheet.cssText=y}else{z.appendChild(A.createTextNode(y))}})(".ww-online,.ww-offline,.ww-mobile{background-image:url(http://assets.taobaocdn.com/sys/wangwang/wangwang_v2.gif)!important;background-repeat:no-repeat;text-decoration:none!important;zoom:1;}.ww-online span,.ww-offline span,.ww-mobile span{visibility:hidden!important;*text-indent:-9999em!important;white-space:nowrap!important;}.ww-online{background-position-y:0;}.ww-offline{background-position-y:-20px;}.ww-mobile{background-position-y:-40px;}html>body .ww-online.ww-large{background-position:0 0;}html>body .ww-online.ww-small{background-position:100% 0;}html>body .ww-offline.ww-large{background-position:0 -20px;}html>body .ww-offline.ww-small{background-position:100% -20px;}html>body .ww-mobile.ww-large{background-position:0 -40px;}html>body .ww-mobile.ww-small{background-position:100% -40px;}.ww-large{width:67px;height:20px;background-position-x:0;}.ww-small{width:20px;height:20px;background-position-x:100%;}.ww-block{display:block;overflow:hidden;margin-top:3px;}.ww-inline{display:inline-block;vertical-align:text-bottom;overflow:hidden;}");if(YAHOO.env.ua.ie){e.Get.script(b,{onSuccess:function(){try{if(-1!=checkIMVersionNoMsg("cntaobao")){r.installed=true}}catch(y){}}})}else{if(YAHOO.env.ua.gecko){e.Get.script(q,{onSuccess:function(){try{r.installed=0;if("undefined"!==typeof AliIM&&Object===AliIM.constructor){r.installed+=1}if("undefined"!==typeof WangWang&&Object===WangWang.constructor){r.installed+=2}if("undefined"!==typeof AliTalk&&Object===AliTalk.constructor){r.installed+=4}}catch(y){}}})}}var u;try{u=document.createElement('<iframe name="aliwangwangSendmsgShowFrame" frameborder="0" src="javascript:false">')}catch(x){u=document.createElement("iframe");u.setAttribute("frameBorder","0");u.name="aliwangwangSendmsgShowFrame";u.src="about:blank"}u.id="aliwangwangSendmsgShowFrame";u.className="hidden";u.style.width=u.style.height=0;c.setStyle(u,"display","none");try{c.insertBefore(u,document.body.firstChild)}catch(x){t.on(window,"load",function(){document.body.appendChild(u)})}var v=function(){var H,y,K="",I;try{I=c.get(n)}catch(J){}var C=I?[I]:document.getElementsByTagName("script");for(var G=0,z=C.length;G<z;++G){y=C[G].getAttribute("src");if(y&&(H=y.match(s))!=null){K=H.length>2?H[2].slice(1):""}}var B={},F=K.split("&"),E;for(var D=0,A=F.length;D<A;++D){if(!F[D]){continue}E=F[D].split("=");B[E[0]]=E[1]}return B};var w=v();if(w.auto!="false"){t.onDOMReady(r._autoLight)}r._scriptParams=w;r._onStatusDataLoadEvent.subscribe(function(z){for(var y=0;y<z.length;y++){r.light(z[y],r._statusMap[z[y].getAttribute("ww:nick")]);z[y].removeAttribute("ww:nick")}})};r._init();TB.ww=r})();